## Datadog Agent Configuration Template for Windows
## Generated by Ansible

# The Datadog API key to associate your agent's data with your organization.
# Your API key can be found at https://app.datadoghq.com/organization-settings/api-keys
api_key: {{ datadog_api_key }}

# The site of the Datadog intake to send Agent data to.
# Can be set to 'datadoghq.com', 'datadoghq.eu', 'us3.datadoghq.com', 'us5.datadoghq.com', 'ddog-gov.com'
site: {{ datadog_site }}

# Set to true to enable the Agent to collect Logs
{% if datadog_logs_enabled | default(false) %}
logs_enabled: true
{% else %}
logs_enabled: false
{% endif %}

# Set to true to enable APM (tracing) collection
{% if datadog_apm_enabled | default(false) %}
apm_config:
  enabled: true
{% else %}
apm_config:
  enabled: false
{% endif %}

# Set to true to enable Process monitoring
{% if datadog_process_enabled | default(false) %}
process_config:
  enabled: true
{% else %}
process_config:
  enabled: false
{% endif %}

{% if datadog_tags is defined and datadog_tags|length > 0 %}
# Host tags
tags:
{% for tag in datadog_tags %}
  - {{ tag }}
{% endfor %}
{% endif %}

# Windows-specific configuration
hostname: {{ ansible_hostname }}

# Additional configuration options
{% if datadog_extra_config is defined %}
{{ datadog_extra_config | to_nice_yaml }}
{% endif %}

---
# Main Datadog Agent configuration for Windows
# Managed by Ansible - DO NOT EDIT MANUALLY

# Agent configuration
{% if datadog_config is defined %}
{% for key, value in datadog_config.items() %}
{{ key }}: {{ value | to_nice_yaml(indent=2) | indent(2, true) }}
{% endfor %}
{% endif %}

# Tags configuration
tags:
{% if datadog_extra_tags is defined %}
{% for tag in datadog_extra_tags %}
  - {{ tag }}
{% endfor %}
{% endif %}
  - "env:{{ datadog_env }}"
  - "ansible_managed:true"
  - "os:windows"

# Logs configuration
{% if datadog_logs_enabled %}
logs_config:
  enabled: true
  logs_dd_url: https://http-intake.logs.{{ datadog_site }}
  processing_enabled: true
  windows_events_enabled: true
{% else %}
logs_config:
  enabled: false
{% endif %}

# Process monitoring
{% if datadog_process_enabled is defined and datadog_process_enabled %}
process_config:
  enabled: true
  process_collection:
    enabled: true
  windows_events_enabled: true
{% else %}
process_config:
  enabled: false
{% endif %}

# APM configuration
{% if datadog_apm_enabled is defined and datadog_apm_enabled %}
apm_config:
  enabled: true
  apm_dd_url: https://trace.agent.{{ datadog_site }}
  windows_events_enabled: true
{% else %}
apm_config:
  enabled: false
{% endif %}

# Windows-specific configuration
win32_event_log:
  - path: System
    type: System
  - path: Application
    type: Application
  - path: Security
    type: Security 